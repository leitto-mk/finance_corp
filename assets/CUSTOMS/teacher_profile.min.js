$(document).ready(function(){if("student"!==$("body").attr("data-status")){function t(t,a){let s="grade_rooms_compact"==a?"#grade_student":"#attd_student";$.ajax({url:"get_student_compact",method:"POST",dataType:"JSON",data:{room:t},error:t=>{console.log(t.responseText)}}).then(t=>{let e="";0==t.length?null==a?$("#grade_student, #attd_student").empty():$(s).empty():t.forEach(t=>{e+=`<option value="${t.NIS}">${t.FullName}</option>`}),null==a?$("#grade_student, #attd_student").html(e):$(s).html(e)}).then(()=>{null==a?$("#grade_student, #attd_student").selectpicker("refresh"):$(s).selectpicker("refresh")}).then(()=>{"attd_rooms_compact"!=a&&e()})}function e(){let t=$("#grade_student").val(),e=$("#grade_rooms_compact").val(),s=$("#grade_subj_compact").val();$("#grade_type_compact").val(),$("#grade_cat_compact").val();$.ajax({url:"get_kd_details",method:"POST",dataType:"JSON",async:"FALSE",data:{id:t,room:e,subj:s},error:t=>{console.log(t.responseText)}}).then(t=>{let e="",a="";t.Type?t.forEach(t=>{"cognitive"==t.Type?e+=`<option data-type="cognitive" value="${t.Code}"><strong>${t.Code}<strong> | ${t.KD} </option>`:"skill"==t.Type&&(a+=`<option data-type="skills" value="${t.Code}"><strong>${t.Code}<strong> | ${t.KD} </option>`)}):(e+='<option data-type="cognitive" value="-">No KD has been set yet</option>',a+='<option data-type="skills" value="-">No KD has been set yet</option>'),$('#grade_type_compact optgroup[label="Pengetahuan"]').html(e),$('#grade_type_compact optgroup[label="Keterampilan"]').html(a)}).then(()=>{a()})}function a(){let t=$("#grade_student").val(),e=$("#grade_rooms_compact").val(),a=$("#grade_subj_compact").val();$.ajax({url:"get_kd_details",method:"POST",dataType:"JSON",async:"FALSE",data:{id:t,room:e,subj:a},success:t=>{let e=$("#grade_type_compact option:selected").attr("data-type"),a=$("#grade_type_compact").val(),s='<option value="">Choose Category</option>';t.forEach(t=>{t.Code==a&&t.Type==e&&(s+=`<option data-field="Grade1" value="Weight1_Desc"> ${""==t.Weight1_Desc?"Kat. 1 (No Desc)":t.Weight1_Desc} </option>`,s+=`<option data-field="Grade2" value="Weight2_Desc"> ${""==t.Weight2_Desc?"Kat. 2 (No Desc)":t.Weight2_Desc} </option>`,s+=`<option data-field="Grade3" value="Weight3_Desc"> ${""==t.Weight3_Desc?"Kat. 3 (No Desc)":t.Weight3_Desc} </option>`)}),$("#grade_cat_compact").html(s)},error:t=>{console.log(t.responseText)}})}function s(t,e,a){Swal.fire({type:t,title:e,text:a})}function r(){$("#student_reports").DataTable({destroy:!0,processing:!0,serverSide:!0,lengthMenu:[10,25,50,500],ajax:{url:"ajx_datatable_get_student_reports",method:"GET",dataSrc:t=>{let e=1;for(let a in t.data)t.data[a].Number=e,e++;return t.data},error:t=>{alert("CANNOT RETRIEVE DATA FROM SERVER"),console.log("%"+t.responseText,"color: #fe346e")}},columns:[{data:"Number",orderable:!1},{data:"IDNumber",orderable:!0},{data:"FullName",orderable:!0},{data:"Kelas",orderable:!1,createdCell:t=>t.setAttribute("align","center")},{data:"Ruangan",orderable:!1,createdCell:t=>t.setAttribute("align","center")},{data:t=>`\n\t\t\t\t\t\t\t<a href="javascript:;"\n\t\t\t\t\t\t\t\tclass="std_assign btn blue btn-xs btn-outline"\n\t\t\t\t\t\t\t\tdata-name="${t.FullName}"\n\t\t\t\t\t\t\t\tdata-id="${t.IDNumber}"\n\t\t\t\t\t\t\t\tdata-cls="${t.Kelas}"\n\t\t\t\t\t\t\t\tdata-room="${t.Ruangan}">\n\t\t\t\t\t\t\t\t<i class="fa fa-check"></i> Assign </a>\n\t\t\t\t\t\t\t<a href="javascript:;"\n\t\t\t\t\t\t\t\tclass="promote btn purple-studio btn-xs btn-outline"\n\t\t\t\t\t\t\t\tdata-name="${t.FullName}"\n\t\t\t\t\t\t\t\tdata-id="${t.IDNumber}"\n\t\t\t\t\t\t\t\tdata-cls="${t.Kelas}"\n\t\t\t\t\t\t\t\tdata-room="${t.Ruangan}">\n\t\t\t\t\t\t\t\t<i class="fa fa-toggle-up"></i> Promote </a>\n\t\t\t\t\t\t\t<div class="btn-group pull-right" style="margin-top: 0px">\n\t\t\t\t\t\t\t\t<button class="btn green btn-xs btn-outline dropdown-toggle" data-toggle="dropdown" id="btn_report">Reports\n\t\t\t\t\t\t\t\t\t<i class="fa fa-angle-down"></i>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t<ul class="dropdown-menu pull-right">\n\t\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t\t<a href="javascript:;" target="_blank" \n\t\t\t\t\t\t\t\t\t\t\tclass="print_mid"\n\t\t\t\t\t\t\t\t\t\t\tdata-id="${t.IDNumber}"\n\t\t\t\t\t\t\t\t\t\t\tdata-cls="${t.Kelas}">\n\t\t\t\t\t\t\t\t\t\t\t<i class="fa fa-print"></i> Mid Report </a>\n\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t\t<a href="javascript:;" target="_blank" \n\t\t\t\t\t\t\t\t\t\t\tclass="print_final"\n\t\t\t\t\t\t\t\t\t\t\tdata-id="${t.IDNumber}"\n\t\t\t\t\t\t\t\t\t\t\tdata-cls="${t.Kelas}">\n\t\t\t\t\t\t\t\t\t\t\t<i class="fa fa-print"></i> Final Report </a>\n\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t</div>`,orderable:!1}]})}function o(t){$.ajax({url:"ajax_get_nonregular_info",method:"POST",dataType:"JSON",data:{type:t},success:t=>{$('select[name="assign_day"]').html(t.schedule),$('select[name="assign_subject"]').html(t.subjects)},error:t=>console.log(t.responseText)})}t($("#grade_rooms_compact").val(),"grade_rooms_compact"),t($("#attd_rooms_compact").val(),"attd_rooms_compact"),r(),$(".nav_profile").click(function(){$('a[href="#profile"]').trigger("click")}),$(".nav_chg_pass").click(function(){$('a[href="#account"]').trigger("click")}),$(".compact_rooms").change(e=>t(e.target.value,e.target.getAttribute("id"))),$("#attd_submit_compact").click(function(){let t=cur_sem,e=cur_per,a=$("#attd_rooms_compact").val(),s=[];s[0]=$("#attd_student").val();let r=$('[name="absent_reason"]:checked').val(),o="",n="";"Truant"!=r&&"Late"!=r||(o=$("#attd_subj_compact").val(),n=$("#attd_hour_compact").val()),c(t,e,a,s,r,o,n,$("#attd_absent_compact").val())}),$("#grade_subj_compact").change(()=>e()),$("#grade_type_compact").change(()=>a()),$("#submit_grade_compact").click(function(t){t.preventDefault();let e={nis:$("#grade_student").val(),fullname:$("#grade_student option:selected").text(),semester:cur_sem,cls:$("#grade_rooms_compact option:selected").attr("data-cls"),room:$("#grade_rooms_compact").val(),subj:$("#grade_subj_compact").val(),type:$("#grade_type_compact option:selected").attr("data-type"),code:$("#grade_type_compact").val(),field:$("#grade_cat_compact option:selected").attr("data-field"),val:$("#input_grade_compact").val()},a=0,r=!0;for(a in e)""!=e[a]&&"-"!=e[a]||(r=!1);r?$.ajax({url:"sv_std_kd_grades",method:"POST",data:e,success:t=>{"success"==t?s("success","GRADE SUBMITTED",""):console.log(t.responseText)},error:t=>{console.log(t.responseText)}}):s("error","SUBMIT FAILED","make sure to fill all the form and input properly")}),$("#student_reports").on("click",".std_assign",function(){$("#assign_name").val($(this).attr("data-name")),$("#assign_name").attr("data-id",$(this).attr("data-id")),$("#assign_name").attr("data-cls",$(this).attr("data-cls")),$("#assign_name").attr("data-room",$(this).attr("data-room")),o($("#assign_type").val()),$("#modal_assign").modal("show")}),$("#assign_type").on("change",function(){o($(this).val())}),$("#modal_assign").on("change","#assign_day",function(){$.ajax({url:"ajax_get_hour_of_day",method:"POST",data:{room:$("#assign_name").attr("data-room"),type:$("#assign_type").val(),day:$(this).val()},success:t=>{$('select[name="assign_hour"]').prop("disabled",!1),$('select[name="assign_hour"]').html(t)},error:t=>console.log(t.responseText)})}),$("#modal_assign").on("change","#assign_hour",function(){$.ajax({url:"ajax_get_nonregular_subjects",method:"POST",data:{room:$("#assign_name").attr("data-room"),type:$("#assign_type").val(),day:$("#assign_day").val(),hour:$(this).val()},success:t=>{$('select[name="assign_subject"]').prop("disabled",!1),$('select[name="assign_subject"]').html(t)},error:t=>console.log(t.responseText)})}),$("#assign_nonregular").submit(function(t){t.preventDefault();let e=$(this).serializeArray();e.push({name:"id",value:$("#assign_name").attr("data-id")},{name:"cls",value:$("#assign_name").attr("data-cls")},{name:"room",value:$("#assign_name").attr("data-room")}),$.ajax({url:"ajax_add_nonregular",method:"POST",data:e,success:t=>{"success"==t?Swal.fire({type:"success",title:"SUCCESS!",text:"Non-Regular has been successfully assigned"}):"SUBJ_REGISTERED"==t?Swal.fire({type:"warning",title:"CANNOT PROCEED!",text:"Non-regular has been registered already for this day and hour of selected student"}):console.log(t)},error:t=>console.log(t.responseText)})}),$("#student_reports").on("click",".promote",function(){let t=$(this).attr("data-id"),e=$(this).attr("data-cls"),a=$(this).attr("data-room");confirm("Promote this student ?")&&$.ajax({url:"ajax_promote_student",method:"POST",data:{id:t,cls:e,room:a},success:t=>{"success"==t?(alert("Student has been promoted to upper class"),r()):console.log(t)},error:t=>console.log(t.responseText)})}),$("#student_reports").on("click",".print_mid",function(t){t.preventDefault();let e=$(this).attr("data-id"),a=$(this).attr("data-cls"),s=cur_sem,r=`${base_url}Teacher/display_report_mid_print?${`nis=${e}&cls=${a}&subj=&semester=${s}`}`;window.open(r)}),$("#student_reports").on("click",".print_final",function(t){t.preventDefault();let e=$(this).attr("data-id"),a=$(this).attr("data-cls"),s=cur_sem;var r=$("#grade_subj_compact > option");let o={};for(let t=0;t<r.length;t++)o[r.eq(t).val()]=r.eq(t).val();Swal.fire({title:"Select Subject",input:"select",inputOptions:o,showCancelButton:!0}).then(t=>{if(t.value){let r=t.value,o=`${base_url}Teacher/display_report_print?${`nis=${e}&cls=${a}&subj=${r}&semester=${s}`}`;window.open(o)}})});let i=async()=>{let t=await fetch("ajax_get_class_attendance_recap"),e=await t.json();console.log(e);let a=[{data:"NIS"},{data:"FullName"}];$("#attd_recap tr").empty(),$("#attd_recap tr:last-child").append('<th class="all" width="1%">NIS</th>\n\t\t\t\t <th class="all" width="35%">Name</th>');let s=["zero","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen","twenty","twentyone","twentytwo","twentythree","twentyfour","twentyfive","twentysix","twentyseven","twentyeight","twentynine","thirty","thirtyone"];for(let t=1;t<=+e.header;t++)$("#attd_recap tr:last-child").append(`<th class="desktop"> ${t} </th>`),a.push({data:s[t],createdCell:t=>{t.setAttribute("align","center"),"Sick"==$(t).text()?(t.classList.add("bg-yellow-saffron"),$(t).text("S")):"On Permit"==$(t).text()?(t.classList.add("bg-purple"),$(t).text("I")):"Absent"==$(t).text()?(t.classList.add("bg-red"),$(t).text("A")):(t.classList.add("bg-default"),$(t).text("-"))}});$("#attd_recap").DataTable({destroy:!0,responsive:!0,processing:!0,ordering:!1,lengthMenu:[10,30,50],columns:a,data:e.pivot})};function n(){let t=$(".selected_period option:selected").attr("data-sem"),e=$(".selected_period option:selected").attr("data-period");$(".sch_caption").html(`TIMETABLE - ${fullname}, Semester ${t} - Period ${e}`),$("#abs_table").DataTable().destroy(),$.ajax({url:"get_full_acd_details",method:"POST",dataType:"JSON",data:{semester:t,period:e},success:t=>{$(".sche_tbody").html(t.schedule),l();for(let e=0;e<t.attendance.length;e++)Object.assign(t.attendance[e],{Index:e+1,Check:`\t<label class="mt-checkbox mt-checkbox-single mt-checkbox-outline">\n        \t\t\t\t\t\t            <input type="checkbox" class="checkboxes" value="${t.attendance[e].NIS}" />\n        \t\t\t\t\t\t            <span></span>\n        \t\t\t\t\t\t        </label>`})},error:t=>{console.log(t.responseText)}}).then(t=>{$("#abs_table").DataTable({destroy:!0,colReorder:!0,data:t.attendance,columns:[{data:"Check"},{data:"Index"},{data:"NIS",render:t=>`<a href="javascript:;" class="fa fa-plus-circle abs_row" data-id="${t}" style="text-decoration: none">\n                                        </a> &nbsp;&nbsp;${t}`},{data:"FullName"},{data:"Total"}],columnDefs:[{targets:0,orderable:!1}]})})}function l(){let t=$(".selected_period option:selected").attr("data-sem"),e=$(".selected_period option:selected").attr("data-period"),a=$("#grades .selected_rooms").val(),s=$("#grades .selected_subj").val(),r=$('#grades input[name="grade_type"]:checked').val(),o="";"cognitive"==r?o="get_full_table_grading_cognitive":"skills"==r?o="get_full_table_grading_skills":"character"==r&&(o="get_full_table_grading_character");let n=$("#grade_inner_tab .active");$.ajax({url:o,method:"POST",dataType:"JSON",data:{semester:t,period:e,cls:a,subj:s,type:r},success:t=>{"cognitive"==r?($('a[href="#grade"]').show(),$('a[href="#grade"]').text("Grade"),$('a[href="#recap"]').text("Recap"),$('a[href="#predicate"]').text("Predicate"),$(".grade_data").html(t.full),$(".recap_data").html(t.recap),$(".predicate_data").html(t.summary)):"skills"==r?($('a[href="#grade"]').hide(),$('a[href="#recap"]').text("Grade"),$('a[href="#predicate"]').text("Predicate"),$(".recap_data").html(t.recap),$(".predicate_data").html(t.summary)):"character"==r&&($('a[href="#grade"]').hide(),$('a[href="#recap"]').text("Social"),$('a[href="#predicate"]').text("Spiritual"),$(".recap_data").html(`<thead>\n\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t<td colspan="2" class="text-center"><b>NOMOR</b></td>\n\t\t\t\t\t\t\t\t\t<td rowspan="2" class="text-center"><b>NAMA</b></td>\n\t\t\t\t\t\t\t\t\t<td colspan="7" class="text-center"><b>REKAP PENILAIAN SIKAP SOSIAL</b></td>\n\t\t\t\t\t\t\t\t\t<td rowspan="2" class="sbold text-center">NILAI</td>\n\t\t\t\t\t\t\t\t\t<td rowspan="2" class="sbold text-center">PREDIKAT</td>\n\t\t\t\t\t\t\t\t\t<td rowspan="2" class="sbold text-center">DESKRIPSI</td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t<td class="text-center"><b> URT </b></td>\n\t\t\t\t\t\t\t\t\t<td class="text-center"><b> INDUK </b></td>\n\t\t\t\t\t\t\t\t\t<td><b>Jujur</b></td>\n\t\t\t\t\t\t\t\t\t<td><b>Disiplin</b></td>\n\t\t\t\t\t\t\t\t\t<td><b>Tanggung Jawab</b></td>\n\t\t\t\t\t\t\t\t\t<td><b>Toleransi</b></td>\n\t\t\t\t\t\t\t\t\t<td><b>Gotong Royong</b></td>\n\t\t\t\t\t\t\t\t\t<td><b>Santun</b></td>\n\t\t\t\t\t\t\t\t\t<td><b>Percaya Diri</b></td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t</thead>\n\t\t\t\t\t\t\t${t.SOC}`),$(".predicate_data").html(`<thead>\n\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t<td colspan="2" class="text-center"><b>NOMOR</b></td>\n\t\t\t\t\t\t\t\t\t<td rowspan="2" class="text-center"><b>NAMA</b></td>\n\t\t\t\t\t\t\t\t\t<td colspan="5" class="text-center"><b>PENILAIAN SIKAP SPIRITUAL</b></td>\n\t\t\t\t\t\t\t\t\t<td rowspan="2" class="sbold text-center">NILAI</td>\n\t\t\t\t\t\t\t\t\t<td rowspan="2" class="sbold text-center">PREDIKAT</td>\n\t\t\t\t\t\t\t\t\t<td rowspan="2" class="sbold text-center">DESKRIPSI</td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t<td rowspan="4" class="text-center"><b> URT </b></td>\n\t\t\t\t\t\t\t\t\t<td rowspan="4" class="text-center"><b> INDUK </b></td>\n\t\t\t\t\t\t\t\t\t<td><b>Berdoa sebelum melakukan kegiatan</b></td>\n\t\t\t\t\t\t\t\t\t<td><b>Bersyukur setelah beraktivitas</b></td>\n\t\t\t\t\t\t\t\t\t<td><b>Toleran pada agama yang berbeda</b></td>\n\t\t\t\t\t\t\t\t\t<td><b>Taat beribadah</b></td>\n\t\t\t\t\t\t\t\t\t<td><b>Memberi Salam dan bertegur sapa</b></td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t</thead>\n\t\t\t\t\t\t\t${t.SPR}`))},error:t=>{console.log(t.responseText)}}).then(()=>{n.children().is('a[href="#grade"]')?(n.removeClass("active"),(n=$("#grade_inner_tab li").eq(1).addClass("active")).trigger("click")):n.trigger("click")})}function d(){let t=$(".selected_period option:selected").attr("data-sem"),e=$(".selected_period option:selected").attr("data-period"),a=$("#voc .selected_voc_rooms").val(),s=$("#voc .selected_voc_subj").val();$.ajax({url:"get_full_table_grading_voc",method:"POST",data:{semester:t,period:e,room:a,subj:s},success:t=>{t?$("#voc tbody").html(t):$("#voc tbody").html('<tr><td class="text-center sbold" colspan="6">No Date for this Semester</td></tr>')},error:t=>console.log(t.responseText)})}function c(t,e,a,r,o,l,d,c){a?$.ajax({url:"add_absent_std",method:"POST",dataType:"JSON",data:{semester:t,period:e,room:a,checked:r,reason:o,subj:l,time:d,date:c},success:t=>{console.log(t),"success"==t&&(s("success","SUBMITED","New Absent has been added"),i())},error:t=>{console.log(t.responseText)}}).then(()=>n()):s("error","SUBMIT FAILED","make sure to fill all the form and input properly")}(async()=>{let t=await fetch("ajax_get_class_full_mid_recap"),e=await t.json(),a=[{data:"NIS"},{data:"FullName"}];for(var s in e.header)$("#full_mid_recap tr:last-child").append(`<th class="desktop"> ${e.header[s].SubjName} </th>`),a.push({data:e.header[s].SubjName.split(" ").join("_"),createdCell:t=>t.setAttribute("align","center")});$("#full_mid_recap").DataTable({destroy:!0,responsive:!0,processing:!0,lengthMenu:[10,30,50],columns:a,data:e.pivot})})(),i(),$.ajax({url:"ajax_get_school_event",dataType:"JSON",success:t=>{let e=[];for(let a in t)e.push({name:t[a].Title,startDate:new Date(t[a].DateStart),endDate:new Date(t[a].DateEnd),color:t[a].Color});new Calendar(".calendar",{dataSource:e,mouseOnDay:function(t){if(t.events.length>0){var e="";for(var a in t.events)e+=`\n\t\t\t\t\t\t\t\t\t<div class="event-tooltip-content">\n\t\t\t\t\t\t\t\t\t\t<div class="event-name" style="color: ${t.events[a].color}">${t.events[a].name}</div>`;$(t.element).popover({trigger:"manual",container:"body",html:!0,content:e}),$(t.element).popover("show")}},mouseOutDay:function(t){t.events.length>0&&$(t.element).popover("hide")},style:"background",displayWeekNumber:!0})},error:t=>console.log(t)}),$("#submit_pass").click(function(){let t=$("#oldpass").val(),e=$("#newpass").val(),a=$("#renewpass").val();$.ajax({url:"chg_pass",method:"POST",data:{oldpass:t,newpass:e,renewpass:a},dataType:"JSON",success:t=>{console.log(t.pwd),$("#account").children(".form-group").removeClass("has-error","has-success"),"empty"==t.code?$("#account").children(".form-group").addClass("has-error"):"incorrect"==t.code?$("#oldpass").parent(".form-group").addClass("has-error"):"identical"==t.code?($("#oldpass").parent(".form-group").addClass("has-error"),$("#newpass").parent(".form-group").addClass("has-error")):"reconfirm"==t.code?($("#newpass").parent(".form-group").addClass("has-error"),$("#renewpass").parent(".form-group").addClass("has-error")):"success"==t.code&&$(".password").val(""),s(t.type,t.title,t.text)},error:()=>{alert("SOMETHING'S WRONG")}})}),$('a[href="#full2"]').click(()=>{n(),d()}),$("#grades").on("change","select",()=>n()),$("#voc").on("change","select",()=>d()),$("#absent > select").change(()=>n()),$(".selected_rooms, .selected_subj").change(()=>l()),$('#grades [type="radio"]').click(()=>l()),$("#grade").on("keypress",'thead td[contenteditable="true"]',function(t){if(13==t.keyCode){t.preventDefault();let e=$(".selected_period option:selected").attr("data-sem"),a=$(".selected_period option:selected").attr("data-period"),r=$(".selected_rooms").val(),o=$(".selected_subj").val(),n=$('input[name="grade_type"]:checked').val(),d=$(this).attr("data-code"),c=$(this).attr("data-field"),i=$(this).text();i=i.replace(/\s+/g,""),$.ajax({url:"update_kd_weight",method:"POST",data:{room:r,semester:e,period:a,type:n,subj:o,code:d,field:c,value:i},error:t=>{console.log(t.responseText)}}).then(t=>{"success"==t?s("success","UPDATED",`Weight for ${d} has been updated`):s("error","FAILED","Something's Wrong")}).then(()=>l())}}),$("#recap").on("keypress",'thead td[contenteditable="true"]',function(t){if(13==t.keyCode&&!$(this).is(".kd_desc_sk")){t.preventDefault();let e=$(".selected_period option:selected").attr("data-sem"),a=$(".selected_period option:selected").attr("data-period"),r=$(".selected_rooms").val(),o=$(".selected_subj").val(),n=$(this).attr("data-field"),d=$(this).text();d=d.replace(/\s+/g,""),$.ajax({url:"update_recap_weight",method:"POST",data:{semester:e,period:a,room:r,subj:o,field:n,value:d},error:t=>{console.log(t.responseText)}}).then(t=>{"success"==t?s("success","UPDATED","Weight for Skill Recap has been updated"):s("error","FAILED","Something's Wrong")}).then(()=>l())}}),$("#recap").on("keypress",".kd_desc_sk",function(t){if(13==t.keyCode){t.preventDefault();let e=$(".selected_period option:selected").attr("data-sem"),a=$(".selected_period option:selected").attr("data-period"),r=$(".selected_rooms").val(),o=$(this).attr("data-type"),n=$(this).attr("data-subj"),d=$(this).attr("data-code"),c=$(this).attr("data-field"),i=$(this).text();$.ajax({url:"update_kd_weight",method:"POST",data:{semester:e,period:a,room:r,type:o,subj:n,code:d,field:c,value:i},error:t=>{console.log(t.responseText)}}).then(t=>{"success"==t?s("success","UPDATED","KD's Skill Description has been updated"):s("error","FAILED","Something's Wrong")}).then(()=>l())}}),$("#grade, #recap").on("keypress",".table_body",function(t){if(13==t.keyCode){t.preventDefault();let e=$(".selected_period option:selected").attr("data-sem"),a=$(".selected_period option:selected").attr("data-period"),r=$(".selected_rooms").val(),o=$(".selected_subj").val(),n=$(this).attr("data-row"),d=$(this).siblings().eq(1).text();d=d.replace(/\s+/g,"");let c,i,p=$(this).parent("tr").attr("data-class"),u=$('input[name="grade_type"]:checked').val(),_=$(this).attr("data-field"),h=$(this).text();if(h=h.replace(/\s+/g,""),"kd"==n){let t=$(this).siblings().eq(2).text(),s=$(this).attr("data-code");s=s.replace(/\s+/g,""),c="sv_std_kd_grades",i={row:n,nis:d,semester:e,period:a,fullname:t,cls:p,room:r,subj:o,type:u,code:s,field:_,val:h}}else c="sv_std_exam_grades",i={row:n,cls:p,nis:d,semester:e,period:a,room:r,subj:o,type:u,field:_,val:h};$.ajax({url:c,method:"POST",data:i,error:t=>{console.log(t.responseText)}}).then(t=>{"success"==t?l():s("error","FAILED","Something's Wrong")})}}),$("#grades").on("keypress",".data_soc_char, .data_spr_char",function(t){if(13==t.keyCode){t.preventDefault();let e=$(".selected_period option:selected").attr("data-sem"),a=$(".selected_period option:selected").attr("data-period"),r=$(".selected_rooms").val(),o=$(".selected_subj").val(),n=$(this).attr("data-type"),d=$(this).siblings().eq(1).text();d=d.replace(/\s+/g,"");let c=$(this).siblings().eq(2).text(),i=$(this).attr("data-desc"),p=$(this).text();p=p.replace(/\s+/g,""),isNaN(p)||p<1||p>4?alert("only number 1 - 4 is allowed"):$.ajax({url:"sv_std_char_grades",method:"POST",data:{nis:d,name:c,semester:e,period:a,subj:o,room:r,type:n,desc:i,value:p},error:t=>{console.log(t.responseText)}}).then(t=>{"success"==t?l():s("error","FAILED","Something's Wrong")})}}),$("#voc").on("keypress",".voc_grade_row",function(t){if(13==t.keyCode){t.preventDefault();let e=$(".selected_period option:selected").attr("data-sem"),a=$(".selected_period option:selected").attr("data-period"),s=$(".selected_voc_rooms").val(),r=$(".selected_voc_subj").val(),o=$(this).siblings().eq(1).text(),n=$(this).text();n=n.replace(/\s+/g,""),$.ajax({url:"sv_std_voc_grades",method:"POST",data:{semester:e,period:a,room:s,subj:r,nis:o,val:n},success:t=>{"success"==t?d():"INVALID_PERIOD"==t?alert("CANNOT UPDATE OLDER SEMESTER"):console.log(t)},error:t=>console.log(t.responseText)})}}),$(".attd_rooms").change(function(){$("#abs_table").DataTable({colReorder:!0,destroy:!0,ajax:{url:"ajax_change_room",method:"POST",data:{room:$(this).val()},dataSrc:t=>{for(let e=0;e<t.length;e++)Object.assign(t[e],{Check:`\t<label class="mt-checkbox mt-checkbox-single mt-checkbox-outline">\n        \t\t\t\t\t\t            \t<input type="checkbox" class="checkboxes" value="${t[e].NIS}" />\n        \t\t\t\t\t\t            \t<span></span>\n        \t\t\t\t\t\t        \t</label>`,Number:e+1});return t},error:t=>{alert("CANNOT RETRIEVE DATA FROM SERVER"),console.log("%"+t.responseText,"color: #fe346e")}},columns:[{data:"Check"},{data:"Number"},{data:"NIS",render:t=>`<a href="javascript:;" class="fa fa-plus-circle abs_row" data-id="${t}" style="text-decoration: none">\n                                        </a> &nbsp;&nbsp;${t}`},{data:"FullName"},{data:"Total"}],columnDefs:[{targets:0,orderable:!1}]})}),$('#absent [name="attendance"], [name="absent_reason"]').click(function(){"Truant"==$(this).val()||"Late"==$(this).val()?$("#specific_attd, #specific_attd_compact").show():$("#specific_attd, #specific_attd_compact").hide()}),$("#absent").on("click",".abs_row",function(){let t=$(this).attr("data-id"),e=$(".selected_period option:selected").attr("data-sem"),a=$(".selected_period option:selected").attr("data-period"),s=$(".attd_rooms").val(),r=$("#abs_table").DataTable().row($(this).closest("tr"));r.child.isShown()?($(this).removeClass("fa-minus-circle red"),$(this).addClass("fa-plus-circle blue"),r.child.hide(),tr.removeClass("shown")):($(this).removeClass("fa-plus-circle blue"),$(this).addClass("fa-minus-circle red"),$.ajax({url:"get_absn_det",method:"POST",dataType:"JSON",data:{id:t,semester:e,period:a,room:s},error:t=>{console.log(t.responseText)}}).then(t=>{r.child(function(t){let e="",a="";if(e+='<ul class="list-group" style="margin: 0px 5px">',0==t.length)e+='\t<li class="list-group-item" align="left"> \n\t\t\t\t\t\t\t\tThis student has perfect attendance!\n\t\t\t\t\t\t\t</li>';else for(let s=0;s<t.length;s++)"Sick"==t[s].Ket?a="badge-warning":"Absent"==t[s].Ket?a="badge-danger":"On Permit"==t[s].Ket?a="badge-success":"Truant"==t[s].Ket?a="badge-primary":"Late"==t[s].Ket&&(a="badge-info"),e+=`\t<li class="list-group-item" align="left"> \n\t\t\t\t\t\t\t\t\t\t${t[s].Absent} | \n\t\t\t\t\t\t\t\t\t\t${null==t[s].SubjDesc?"-":t[s].SubjDesc} | \n\t\t\t\t\t\t\t\t\t\t${null==t[s].Hour?"-":t[s].Hour}\n\t\t\t\t\t\t\t\t\t<span class="badge ${a}"> \n\t\t\t\t\t\t\t\t\t\t${t[s].Ket} \n\t\t\t\t\t\t\t\t\t\t<a href="javascript:;" class="fa fa-times delete_absn" \n\t\t\t\t\t\t\t\t\t\tdata-id="${t[s].NIS}"\n\t\t\t\t\t\t\t\t\t\tdata-date="${t[s].Absent}" \n\t\t\t\t\t\t\t\t\t\tdata-reason="${t[s].Ket}"\n\t\t\t\t\t\t\t\t\t\tdata-subj="${t[s].SubjDesc}" \n\t\t\t\t\t\t\t\t\t\tdata-hour="${t[s].Hour}" \n\t\t\t\t\t\t\t\t\t\tstyle="color: white;text-decoration: none"></a>\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</li>`;return e+="</ul>"}(t)).show()}))}),$('#absent button[type="submit"]').click(function(){let t=$(".selected_period option:selected").attr("data-sem"),e=$(".selected_period option:selected").attr("data-period"),a=$(".attd_rooms").val(),r=[];r[0]=$("input .checkboxes:checked").val();let o=$('[name="attendance"]:checked').val(),n="",l="";"Truant"!=o&&"Late"!=o||(l=$('[name="time_abs"]').val(),n=$(".abs_subj").val());let d=$('input[name="date_abs"]').val();$(".checkboxes:checked").each(function(t){r[t]=$(this).val()}),0==r.length||""==o||""==d?s("error","CANNOT PROCEED","Make sure the requested form are filled and have at least 1 student selected from the table"):c(t,e,a,r,o,n,l,d)}),$("#absent").on("click",".delete_absn",function(){if(1==window.confirm("Confirm deletion ?")){let t=$(this).attr("data-id"),e=$(this).attr("data-date"),a=$(this).attr("data-reason"),r=$(this).attr("data-subj"),o=$(this).attr("data-hour"),l=$(".selected_period option:selected").attr("data-sem"),d=$(".selected_period option:selected").attr("data-period"),c=$(".attd_rooms").val();$.ajax({url:"delete_absn",method:"POST",data:{id:t,date:e,reason:a,subj:r,hour:o,semester:l,period:d,room:c},error:t=>{console.log(t.responseText)}}).then(t=>{"success"==t&&s("success","DELETED","Delete successfull")}).then(()=>n())}})}});