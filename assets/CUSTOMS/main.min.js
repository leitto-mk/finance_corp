$(document).ready(function(){console.log(`Your screen resolution is:  ${window.screen.width} x ${window.screen.height}`),window.screen.width<=1366&&(document.body.style.zoom=.75);var e=window.location.href;function t(){$.ajax({url:"ajax_get_school_event",dataType:"JSON",success:e=>{let a=[];for(var o in e)a.push({title:e[o].Title,start:e[o].DateStart,end:e[o].DateEnd,backgroundColor:e[o].Color});$("#calendar").fullCalendar("destroy"),$("#calendar").fullCalendar({header:{left:"month, basicDay, basicWeek, today",center:"",right:"title, prev, next"},contentHeight:550,events:a,eventClick:e=>{let a=e.title,o=e.start._i,s=null==e.end?e.start._i:e.end._i,l=e.backgroundColor;$("#calendar_action").modal("show"),$("#eventchange_title").val(a),$("#eventchange_date_start").val(o),$("#eventchange_date_end").val(s),$("#eventchange_color").val(l),function(e,a,o){$("#submitcalendarchange").click(function(){let s=$('[name="calendarradio"]:checked').val(),l=$("#eventchange_title").val(),r=$("#eventchange_date_start").val(),n=$("#eventchange_date_end").val(),c=$("#eventchange_color").val(),i=new Date(r),d=new Date(n);i>d?alert("START MUST BE HIGHER THAN END"):$.ajax({url:"ajax_update_school_event",method:"POST",data:{eventchange:s,title:e,newtitle:l,start:a,newstart:r,end:o,newend:n,newcolor:c},success:e=>{"success"==e?t():(alert("SOMETHING'S WRONG"),console.log(e)),$("#calendar_action").modal("hide")},error:e=>console.log(e.responseText)})})}(a,o,s)}})},error:e=>console.log(e.responseText)})}function a(e){$.ajax({url:"get_class_list",method:"POST",data:{degree:e},success:function(e){$(".table").empty(),$(".table").html(e)}})}$(".subnav").each(function(){$(this).attr("href")===e&&($(this).parents(".main").addClass("active open selected"),$(this).parent().addClass("active"))}),$("#submit_calendar").on("click",function(e){e.preventDefault();let a=$("#event_title").val(),o=$("#event_date_start").val(),s=$("#event_date_end").val(),l=$("#event_color").val();new Date(o)>new Date(s)?alert("START MUST BE HIGHER THAN END"):$.ajax({url:"ajax_sv_school_event",method:"POST",data:{title:a,date_start:o,date_end:s,color:l},success:e=>{"success"==e?(alert("NEW EVENT HAS BEEN ADDED !"),t()):(alert("SOMETHING'S WRONG"),console.log(e))},error:e=>console.log(e.responseText)})}),t(),$('[name="calendarradio"]').change(function(){"delete"==$(this).val()?$("#eventchange").prop("hidden",!0):$("#eventchange").prop("hidden",!1)}),$.get("getChart").then(e=>{e=JSON.parse(e);let t=[],a=[];for(let a in e.pie)t.push({rooms:e.pie[a].Ruangan,value:e.pie[a].Total});for(let t in e.bar)a.push({semester:e.bar[t].Semester,total:e.bar[t].Total,period:e.bar[t].schoolyear});AmCharts.makeChart("chart_7",{type:"pie",theme:"light",fontFamily:"Open Sans",color:"#888",valueField:"value",titleField:"rooms",dataProvider:t,outlineAlpha:.5,depth3D:15,balloonText:"[[title]]<br><span style='font-size:14px'><b>[[value]] students</b> ([[percents]]%)</span>",angle:30,exportConfig:{menuItems:[{icon:"/lib/3/images/export.png",format:"png"}]}}),AmCharts.makeChart("chart_1",{type:"serial",theme:"light",pathToImages:App.getGlobalPluginsPath()+"amcharts/amcharts/images/",autoMargins:!0,fontFamily:"Open Sans",color:"#888",dataProvider:a,valueAxes:[{axisAlpha:0,position:"left"}],graphs:[{title:"students",type:"column",valueField:"total",alphaField:"alpha",balloonText:"<span style='font-size:13px;'>[[title]] in semester [[semester]]: <b>[[value]]</b> [[additional]]</span>",dashLengthField:"dashLengthColumn",fillAlphas:1},{balloonText:"<span style='font-size:13px;'>[[title]] in semester [[semester]]: <b>[[value]]</b> [[additional]]</span>",bullet:"round",dashLengthField:"dashLengthLine",lineThickness:3,bulletSize:7,bulletBorderAlpha:1,bulletColor:"#FFFFFF",useLineColorForBulletBorder:!0,bulletBorderThickness:3,fillAlphas:0,lineAlpha:1,title:"period",valueField:"semester"}],categoryField:"period",categoryAxis:{gridPosition:"start",axisAlpha:0,tickLength:0}})}),$.ajax({url:"get_active_degree",method:"GET",dataType:"JSON",success:e=>{1==e.SD?$(".toggle_sd").addClass("sbold").css({opacity:"1",color:"white","font-size":"150%"}):0==e.SD&&$(".toggle_sd").removeClass("sbold").css({opacity:"0.6",color:"black","font-size":"100%"}),1==e.SMP?$(".toggle_smp").addClass("sbold").css({opacity:"1",color:"white","font-size":"150%"}):0==e.SMP&&$(".toggle_smp").removeClass("sbold").css({opacity:"0.6",color:"black","font-size":"100%"}),1==e.SMA?$(".toggle_sma").addClass("sbold").css({opacity:"1",color:"white","font-size":"150%"}):0==e.SMA&&$(".toggle_sma").removeClass("sbold").css({opacity:"0.6",color:"black","font-size":"100%"}),1==e.SMK?$(".toggle_smk").addClass("sbold").css({opacity:"1",color:"white","font-size":"150%"}):0==e.SMK&&$(".toggle_smk").removeClass("sbold").css({opacity:"0.6",color:"black","font-size":"100%"})}}),$(".upload_ico").click(function(e){e.preventDefault(),$(".upload_sch_img").trigger("click")}),$(".save_report").click(function(){let e=$(this).attr("name"),t=$(this).parents().find(`input[name="${e}"]`).val();$.ajax({url:"ajax_save_report",method:"POST",data:{field:e,val:t},success:e=>{"success"==e?alert("INFORMATION HAS BEEN UPDATED"):(alert("SOMETHING'S WRONG"),console.log(e))},error:e=>console.log(e.responseText)})});let o=async()=>{let e=$("#recap_rooms_mid").val(),t=await fetch(`ajax_get_class_full_mid_recap?room=${e}`),a=await t.json(),o=[{data:"NIS"},{data:"FullName"}];for(var s in $("#full_mid_recap tr").empty(),$("#full_mid_recap tr:last-child").append('<th class="all" width="1%">NIS</th>\n\t\t\t <th class="all" width="35%">Name</th>'),a.header)$("#full_mid_recap tr:last-child").append(`<th class="desktop"> ${a.header[s].SubjName} </th>`),o.push({data:a.header[s].SubjName.split(" ").join("_"),createdCell:e=>e.setAttribute("align","center")});$("#full_mid_recap").DataTable({destroy:!0,responsive:!0,processing:!0,lengthMenu:[30,50],columns:o,data:a.pivot})};$("#recap_rooms_mid").change(function(){o()}),$("#print_recap_mid").click(function(e){e.preventDefault();let t=$("#recap_rooms_mid").val();window.location.replace(`print_recap_mid?room=${t}`)});let s=async()=>{let e=$("#recap_rooms_attd").val(),t=$("#attd_month").val(),a=await fetch(`ajax_get_class_attendance_recap?room=${e}&month=${t}`),o=await a.json();console.log(o);let s=[{data:"NIS"},{data:"FullName"}];$("#attd_recap tr").empty(),$("#attd_recap tr:last-child").append('<th class="all" width="1%">NIS</th>\n\t\t\t\t<th class="all" width="35%">Name</th>');let l=["zero","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen","twenty","twentyone","twentytwo","twentythree","twentyfour","twentyfive","twentysix","twentyseven","twentyeight","twentynine","thirty","thirtyone"];for(let e=1;e<=+o.header;e++)$("#attd_recap tr:last-child").append(`<th class="desktop"> ${e} </th>`),s.push({data:l[e],createdCell:e=>{e.setAttribute("align","center"),"Sick"==$(e).text()?(e.classList.add("bg-yellow-saffron"),$(e).text("S")):"On Permit"==$(e).text()?(e.classList.add("bg-purple"),$(e).text("I")):"Absent"==$(e).text()?(e.classList.add("bg-red"),$(e).text("A")):(e.classList.add("bg-default"),$(e).text("-"))}});$("#attd_recap").DataTable({destroy:!0,responsive:!0,processing:!0,ordering:!1,lengthMenu:[10,30,50],columns:s,data:o.pivot})};var l;$("#recap_rooms_attd, #attd_month").change(function(){s()}),$("#print_attd").click(function(e){e.preventDefault();let t=$("#recap_rooms_attd").val(),a=$("#attd_month").val();window.location.replace(`print_attendance_recap?room=${t}&month=${a}`)}),o(),s(),$(".toggle_sd, .toggle_smp, .toggle_sma, .toggle_smk").click(function(){switch(l=$(this).attr("data-degree"),$(".degree_opt").modal("show"),l){case"SD":$(".ribbon-shadow").css("background-color","#e7505a"),$(".ribbon-shadow").text("Elementary School");break;case"SMP":$(".ribbon-shadow").css("background-color","#4B77BE"),$(".ribbon-shadow").text("Junior High School");break;case"SMA":$(".ribbon-shadow").css("background-color","#95A5A6"),$(".ribbon-shadow").text("High School");break;case"SMK":$(".ribbon-shadow").css("background-color","#f36a5a"),$(".ribbon-shadow").text("Vocational School")}$.ajax({url:"get_state",method:"POST",data:{degree:l},success:e=>{1==e?($("#active").prop("checked",!0),$("#active").parent(".md-radio").addClass("has-success")):($("#deactive").prop("checked",!0),$("#deactive").parent(".md-radio").addClass("has-error"))}}),a(l)}),$('input[name="toggle_degree"]').change(function(){let e;if("active"==$(this).attr("id")){$("#deactive").parent(".md-radio").removeClass("has-error"),$(this).parent(".md-radio").addClass("has-success");let t=$(`button[data-degree="${l}"]`);t.addClass("sbold"),t.css({opacity:"1",color:"white","font-size":"150%"}),e=1}else{$("#active").parent(".md-radio").removeClass("has-success"),$(this).parent(".md-radio").addClass("has-error");let t=$(`button[data-degree="${l}"]`);t.removeClass("sbold"),t.css({opacity:"0.6",color:"black","font-size":"100%"}),e=0}$.ajax({url:"toggle_degree",method:"POST",data:{degree:l,active:e}})}),$(".table").on("click",".new_room",function(){let e=$(this).parents("th").attr("data-class"),t=$(this).parents("th").attr("data-class-num");console.log(l,e,t),$.ajax({url:"add_room",method:"POST",data:{degree:l,cls:e,num:t},success:e=>{console.log(e),"success"==e&&a(l)},error:e=>{console.log(e)}})}),$(".table").on("click",".remove_room",function(){var e=$(this).attr("data-room");Swal.fire({type:"warning",title:"Are You Sure !?",text:"\n\t\t\t\t\tRoom of $ {\n\t\t\t\t\t\troom\n\t\t\t\t\t}\n\t\t\t\t\twill be purged "}).then(t=>{t.value&&$.ajax({url:"delete_room",method:"POST",data:{room:e},success:t=>{console.log(t),"success"==t?$(`\n\t\t\t\t\ta[data - room = "${e}"]\n\t\t\t\t\t`).fadeOut("fast"):"abort"==t&&Swal.fire({type:"warning",title:"Deletion Failed",text:"Only room B to 'N' are capable of purging"})},error:()=>{Swal.fire({type:"warning",title:"Failed !?",text:"\n\t\t\t\t\tRoom $ {\n\t\t\t\t\t\troom\n\t\t\t\t\t}\n\t\t\t\t\tis already assigned with Schedule or Homeroom Teacher "})}})})}),$(".table").on("click",".new_smk_room",function(){let e=$(this).attr("data-class"),t=$(this).attr("data-subprogram"),o=$(this).attr("data-numeric");$.ajax({url:"add_smk_room",method:"POST",data:{cls:e,subprogram:t,cls_numeric:o},success:e=>{"success"==e?a(l):(alert("SOMETHING'S WRONG"),console.log(e))},error:e=>console.log(e.responseText)})}),$(".table").on("click",".remove_smk_room",function(){let e=$(this).attr("data-room");$.ajax({url:"delete_smk_room",method:"POST",data:{room:e},success:e=>{"success"==e?a(l):(alert("SOMETHING'S WRONG"),console.log(e))},error:e=>console.log(e.responseText)})})});