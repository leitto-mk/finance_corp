$(document).ready(function(){if($("div").is(".schedule")){function e(){$.ajax({url:"get_full_tbl_session",method:"POST",dataType:"JSON",success:e=>{console.log(e),$(".sess_list").remove(),$(".tr_session_reg").html(e.reg),$(".tr_session_elc").html(e.elc),$(".tr_session_exc").html(e.exc),$(".tr_session_non").html(e.non)}})}var t;function s(e){$.ajax({url:"load_sche_details",method:"POST",data:{room:e},success:function(e){$(".std_rep").html(e)},error:function(){console.log("SOMETHING'S WRONG")}})}$.ajax({url:"get_degrees",method:"GET",success:e=>{$(".nav_degrees").append(e);let t=$(".caption").first().text();"SD"==(t=t.replace(/\s/g,""))?s("I (A)"):"SMP"==t?s("VII (A)"):"SMA"==t&&s("X IPA (A)"),$.ajax({url:"load_classes_sch_sd",method:"GET",datatype:"JSON",success:function(e){$(".sch_sd_classes").append(e)},error:e=>console.log(e.responseText)}),$.ajax({url:"load_classes_sch_smp",method:"GET",datatype:"JSON",success:function(e){$(".sch_smp_classes").html(e)},error:e=>console.log(e.responseText)}),$.ajax({url:"load_classes_sch_sma",method:"GET",datatype:"JSON",success:function(e){$(".sch_sma_classes").html(e)},error:e=>console.log(e.responseText)}),$.ajax({url:"load_classes_sch_smk",method:"GET",datatype:"JSON",success:function(e){$(".sch_smk_classes").html(e)},error:e=>console.log(e.responseText)})}}),$('[data-toggle="tooltip"]').tooltip(),$(".bootstrap-switch").click(function(){$(".make-switch").is(":checked")?$(".additional").css("display","block"):$(".additional").css("display","none")}),$(".hour_opt").click(function(){$(".timepicker").timepicker({minuteStep:5,maxHours:22,defaultTime:"06:00",showMeridian:!1}),$(".make-switch").is(":checked")?$(".additional").css("display","block"):$(".additional").css("display","none"),$(".opt_title").text("Hour Settings"),$(".options").modal("show")}),$(".sess_opt").click(function(){$(".edit_sessions").modal("show"),e()}),$('select[name="sess_type"]').change(function(){t=""!=$(this).val()?$(this).val():""}),$(".new_sess").click(function(){let s=t,a=$(".sess_code").val(),o=$(".sess_name").val(),r=$("#sess_degree").val();""==s||""==o||""==a?Swal.fire({type:"error",title:"Please fill all the form, before continue",showConfirmButton:!1,timer:1500}):$.ajax({url:"sv_new_session",method:"POST",data:{type:s,code:a,name:o,degree:r},success:t=>{"is_available"==t?Swal.fire({type:"error",title:"Cannot add because session already contains either values or both",showConfirmButton:!1,timer:1500}):"success"==t&&(e(),Swal.fire({type:"success",title:"New Session has been added",showConfirmButton:!1,timer:1500}))}})}),$(".tr_session_reg, .tr_session_elc, .tr_session_exc, .tr_session_non").on("keypress",'td[contenteditable="true"]',function(t){if(13==t.keyCode){t.preventDefault();let s=$(this).attr("data-field"),a=$(this).attr("data-cur"),o=$(this).text(),r="Degree"==s?$(this).attr("data-subj"):"";$.ajax({url:"edit_session",method:"POST",data:{field:s,old:a,newv:o,subj:r},success:t=>{console.log(t),"success"==t?(Swal.fire({type:"success",title:"UPDATE SUCCESS",text:`${a} has been updated to ${o}`}),e()):"is_available"==t?(Swal.fire({type:"error",title:"UPDATE FAILED",text:"YOU NEW ENTRY IS ALREADY LISTED"}),e()):"is_attached"==t?(Swal.fire({type:"error",title:"UPDATE FAILED",text:"YOU NEW ENTRY IS ALREADY AFFILIATED WITH ACTIVE SCHEDULE"}),e()):"is_undefined"==t&&(Swal.fire({type:"error",title:"UPDATE FAILED",text:"INPUT CAN ONLLY BE EITHER -> 'ALL', 'SD', 'SMP', 'SMA', 'SMK'"}),e())},error:e=>{console.log(e)}})}}),$(".tr_session_reg, .tr_session_elc, .tr_session_exc, .tr_session_non").on("click",".del_sess",function(){let t=$(this).attr("data-subj");$.ajax({url:"det_session",method:"POST",data:{subjname:t},success:s=>{"success"==s?(Swal.fire({type:"success",title:"DELETED",text:`${t} has been deleted from session`}),e()):"is_available"==s&&Swal.fire({type:"error",title:"DELETION FAILED",text:"SESSION HAS ALREADY TIED WITH ACTIVE SCHEDULE"})},error:e=>{console.log(e)}})}),$(".sv_hcon").click(function(){let e,t=$(".hlevel").val(),a=$(".numclass").val(),o=$(".hstart").val(),r=$(".hinterval").val();e=$(".make-switch").is(":checked")?"ON":"OFF";let l=$(".break1").val(),n=$(".break1interval").val(),i=$(".caregroup").val(),c=$(".caregroupinterval").val(),d=$(".break2").val(),u=$(".break2interval").val(),h=$(".exculinterval").val();$.ajax({url:"sv_hour_config",method:"POST",data:{hlevel:t,hourperday:a,hstart:o,hinterval:r,preset:e,break1:l,break1interval:n,caregroup:i,caregroupinterval:c,break2:d,break2interval:u,exculinterval:h},success:function(e){"false"!=e?($(".options").modal("hide"),console.log("Schedule is already set"),$(".options").modal("hide"),Swal.fire("Success!","Schedule's hour has been updated","success"),"SD"==t?s("I (A)"):"SMP"==t?s("VII (A)"):"SMA"==t&&s("X IPA (A)")):(console.log(e),$(".options").modal("hide"),Swal.fire({type:"error",title:"Oops...",text:"Hours are already set!"}))}})}),$(".reset_curhour").click(function(){var e=$(".hlevel").val(),t="";$(".options").modal("hide"),"SD"==e?t="Elementary School":"SMP"==e?t="Junior School":"SMP"==e&&(t="High School"),Swal.fire({title:"Reset Hour Preset for this Degree?",text:"You won't be able to revert this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes"}).then(a=>{a.value&&$.ajax({url:"reset_hcon",method:"POST",data:{level:e},success:function(a){"is_used"==a?Swal.fire({type:"error",title:"Reset Failed",text:`Hours for ${t} is in use. please clear the schedule before reset the hours.`}):(Swal.fire("Deleted!",`${e}'s Hours has been reset`,"success"),"SD"==e?s("I (A)"):"SMP"==e?s("VII (A)"):"SMA"==e&&s("X IPA (A)"))}})})}),$(".std_rep").on("click",".btn_edit_hour",function(){let e=$(this).attr("data-start"),t=$(this).attr("data-finish"),s=$(this).attr("data-room");$(".type").change(function(){if("dec"==$(this).val())$.ajax({url:"get_decrease_minute",method:"POST",data:{current:e,finish:t},success:function(e){$(".interval").replaceWith(e)}});else{let e="";e+='<select class="form-control edited interval" id="form_control_1">',e+='<option value="" selected>by...</option>';for(let t=5;t<=60;t+=5)e+="<option value="+t+"> "+t+" Minutes </option>";e+="</select>",$(".interval").replaceWith(e)}}),$(".curhour_desc").html(`Hour: <span style="font-size: 40px; font-weight: 350"> ${e}-${t} </span>`),$(".curhour_desc").attr("data-cur-hour",e),$(".curhour_desc").attr("data-room",s),$(".hour_title").text("Change specific hour"),$(".edit_hour").modal("show")}),$(".edit_hour").on("click",".sv_curhour",function(){let e=$(".curhour_desc").attr("data-cur-hour");var t=$(".caption-subject").attr("data-degree");let a=$(".curhour_desc").attr("data-room"),o="";"SD"==t?o="Elementary School":"SMP"==t?o="Junior School":"SMA"==t&&(o="High School");let r=$(".type").val(),l=$(".interval").val();$.ajax({url:"sv_new_curhour",method:"POST",datatype:"JSON",data:{cur:e,room:a,type:r,interval:l},success:function(e){Swal.fire({position:"top-end",type:"success",title:`Hour has been updated for ${o}`,showConfirmButton:!1,timer:1500}),console.log(e),$(".edit_hour").modal("hide"),"SD"==t?s("I (A)"):"SMP"==t?s("VII (A)"):"SMA"==t&&s("X IPA (A)")},error:function(e){Swal.fire({position:"top-end",type:"error",title:`Hour failed to update for ${o}`,showConfirmButton:!1,timer:1500}),console.log(e),$(".edit_hour").modal("hide"),"SD"==t?s("I (A)"):"SMP"==t?s("VII (A)"):"SMA"==t&&s("X IPA (A)")}})}),$(".classes").on("click",".detail_sche",function(){s($(this).attr("data-room"))}),$(".change_type").on("change",'select[name="type"]',function(){let e=$(this).val();"Regular"!=e?$(".teacher").css("display","none"):$(".teacher").css("display","block"),$(this).attr("data-type",e),$.ajax({url:"get_session_type",method:"POST",data:{type:e},success:t=>{"Elective"==e?$('select[name="subj"]').html('<option value="Elective"> ELECTIVE </option>'):"Excul"==e?$('select[name="subj"]').html('<option value="Excul"> EXCUL </option>'):$('select[name="subj"]').replaceWith(t)}})}),$(".std_rep").on("click",".add_sche",function(){let e=$(this).attr("data-room");$.ajax({url:"load_add_sch",method:"POST",datatype:"JSON",data:{room:e},success:function(e){"no_students"==e?Swal.fire({type:"error",title:"Add Subject Failed",text:"Students must be assigned to this class first"}):($(".mdl-add").html(e),$("#new-sch").modal("show"))},error:function(){alert(`${e} failed to get data`)}})}),$(".mdl-add").on("click",".submit_new_sche",function(){var e=$('select[name="room"]').val(),t=$('select[name="day"]').val(),a=$('select[name="hour"]').val(),o=$('select[name="type"]').val(),r=$('select[name="subj"]').val(),l=$('select[name="teacher"]').val(),n=$('textarea[name="note"]').val();""!=t&&""!=a&&""!=o&&""!=r?$.ajax({url:"check_teacher_avail",method:"POST",data:{day:t,hour:a,teacher:l},success:function(i){if(console.log(i),"proceed"==i)$.ajax({url:"save_add_sch",method:"POST",data:{room:e,day:t,hour:a,type:o,subj:r,teacher:l,note:n},success:t=>{console.log(t),"success"==t?(Swal.fire({type:"success",title:"Added...",text:"New schedule has been added"}),$("#new-sch").modal("hide"),s(e)):(Swal.fire({type:"error",title:"Something's wrong...",text:"Failed to add new Schedule"}),$("#new-sch").modal("hide"),s(e))},error:()=>{Swal.fire({type:"error",title:"Failed...",text:"Error: 500 (Internal Server Error)"}),$("#new-sch").modal("hide"),s(e)}});else{let t=$('select[name="teacher"] option:selected').attr("data-name");Swal.fire({type:"error",title:"Add Schedule Fails",text:`${t} has been assigned at another class for the same Day and Hour`,showConfirmButton:!0}),$("#new-sch").modal("hide"),s(e)}}}):Swal.fire({type:"warning",title:"Submit Denied",text:"Unable to submit new schedule. make sure every form is selected accordingly"})}),$(".mdl-add").on("change",'select[name="day"]',function(){if(""!=$(this).val()){let e=$("#room").val(),t=$(this).val();console.table({room:e,day:t}),$.ajax({url:"load_unpicked_hour",method:"POST",data:{room:e,day:t},success:e=>{$('select[name="hour"]').replaceWith(e)}})}}),$(".std_rep").on("click",".btn_edit_sch",function(){var e=$(this).attr("data-day"),t=$(this).attr("data-room"),a=$(this).attr("data-hour"),o=$(this).attr("data-subj");$.ajax({url:"load_edit_sch",method:"POST",data:{day:e,room:t,hour:a,subj:o},success:function(e){$(".detail-class").modal("hide"),$(".edit-body").html(e),$(".modal-title").text(`Edit Class: ${t}`),$(".modal-edit").modal("show"),s(t)},error:function(){alert(`${t} failed to POST to controller`)}})}),$(".sv_upd_sche").click(function(){let e=$('select[name="room"] option:selected').val(),t=$('select[name="day"] option:selected').val(),a=$('select[name="hour"] option:selected').val(),o=$('select[name="type"] option:selected').val(),r=$('select[name="subj"] option:selected').val(),l=$('select[name="teacher"] option:selected').val(),n=$('textarea[name="note"]').val();""!=o&&""!=r&&""!=l?$.ajax({url:"save_sche_update",method:"POST",data:{upd_room:e,upd_day:t,upd_hour:a,upd_type:o,upd_subj:r,upd_teacher:l,upd_note:n},success:function(t){console.log(t),"success"==t?(Swal.fire({type:"success",title:"Success...",text:"Session has been updated"}),$(".modal-edit").modal("hide"),s(e)):"unproceed"==t&&(Swal.fire({type:"error",title:"Add Schedule Fails",text:`${l} has been assigned at another class for the same Day and Hour`,showConfirmButton:!0}),$(".modal-edit").modal("hide"),s(e))},error:function(){Swal.fire({type:"error",title:"Failed...",text:"Error: 500 (Internal Server Error)"}),$(".modal-edit").modal("hide"),s(e)}}):Swal.fire({type:"warning",title:"Submit Denied",text:"Unable to submit new schedule. make sure every form is selected accordingly"})}),$(".std_rep").on("click",".delete_sche",function(){let e=$(this).attr("data-room");Swal.fire({title:"Clear schedule for this Class?",text:"You won't be able to revert this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes"}).then(t=>{t.value&&$.ajax({url:"delete_sche",method:"POST",datatype:"JSON",data:{room:e},success:function(){console.log("DELETE SUCCESS"),Swal.fire({type:"success",title:"Success",text:`Schedule for ${e} has been cleared`}),$(".del-confirm").modal("hide"),s(e)},error:function(){alert("SOMETHING'S WRONG"),$(".del-confirm").modal("hide")}})})}),$(document).on("click",".btn_edit_nonregular",function(){$("#assign_room").val($(this).attr("data-room")),$("#assign_type").val($(this).attr("data-type")),$("#assign_day").val($(this).attr("data-day")),$("#assign_hour").val($(this).attr("data-hour")),$.ajax({url:"ajax_get_nonregular_subject",method:"POST",dataType:"JSON",data:{room:$("#assign_room").val(),type:$("#assign_type").val(),day:$("#assign_day").val(),hour:$("#assign_hour").val()},success:e=>{$(".listed").html(e.list),$("#assign_subject").html(e.subj),$("#assign_teacher").html(e.teacher)},error:e=>console.log(e.responseText)}),$("#modal_assign").modal("show")}),$(".mt-repeater-add").click(function(){$.ajax({url:"ajax_get_nonregular_subject",method:"POST",dataType:"JSON",data:{room:$("#assign_room").val(),type:$("#assign_type").val()},success:e=>{$(".subject_repeater").each(function(){""==$(this).val()&&$(this).html(e.subj)}),$(".teacher_repeater").each(function(){""==$(this).val()&&$(this).html(e.teacher)})},error:e=>console.log(e.responseText)})}),$("#assign_nonregular").submit(function(e){e.preventDefault();let t=$(this).serializeArray();$.ajax({url:"ajax_submit_nonregular",method:"POST",data:t,success:e=>{"success"==e?(alert("SUCCESS..."),$.ajax({url:"ajax_get_nonregular_subject",method:"POST",dataType:"JSON",data:{room:$("#assign_room").val(),type:$("#assign_type").val(),day:$("#assign_day").val(),hour:$("#assign_hour").val()},success:e=>{$(".listed").html(e.list),$("#assign_subject").html(e.subj),$("#assign_teacher").html(e.teacher)},error:e=>console.log(e.responseText)})):(alert("SOMETHING'S WRONG"),console.log(e))},error:e=>console.log(e.responseText)})}),$(document).on("click",".listed_subj",function(){var e=$(this).attr("data-subj"),t=$(this).attr("data-room"),s=$(this).attr("data-semester"),a=$(this).attr("data-period"),o=$(this).attr("data-hour"),r=$(this).attr("data-day");$.ajax({url:"ajax_delete_nonregular",method:"POST",data:{subj:e,room:t,semester:s,period:a,hour:o,day:r},success:e=>{"success"==e?($(this).parents(".listed").empty(),$.ajax({url:"ajax_get_nonregular_subject",method:"POST",dataType:"JSON",data:{room:$("#assign_room").val(),type:$("#assign_type").val(),day:$("#assign_day").val(),hour:$("#assign_hour").val()},success:e=>{$(".listed").prepend(e.list)},error:e=>console.log(e.responseText)})):(alert("SOMETHING'S WRONG"),console.log(e))},error:e=>console.log(e.responseText)})})}});