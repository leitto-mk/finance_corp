$(document).ready(function(){if($("div").is(".grade")){var e,t,a,s;function l(e,t,a){$.ajax({url:"get_kd_by_subject",method:"POST",dataType:"JSON",data:{type:e,cls:t,subj:a},success:e=>{$(".semester1, .semester2").empty(),$(".semester1").append(e.Semester1),$(".semester2").append(e.Semester2),$(".btn_new_kd").attr("data-subj",a)}})}function r(s){$.ajax({url:"edit_kd",method:"POST",data:s,success:()=>{$(".semester1, .semester2").empty(),l(a,e,t)}})}function d(){$.ajax({url:"get_active_degrees_grade",mehod:"POST",success:e=>{$(".nav_degrees").append(e);let t=$(".caption").first().text();"SD"==(t=t.replace(/\s/g,""))?o("I"):"SMP"==t?o("VII"):"SMA"==t&&o("X IPA"),$.ajax({url:"load_classes_sd",method:"GET",datatype:"JSON",success:function(e){$(".sd_classes").append(e)},error:function(){console.log("AJAX Schedule doesn't work properly")}}),$.ajax({url:"load_classes_smp",method:"GET",datatype:"JSON",success:function(e){$(".smp_classes").html(e)},error:function(){alert("AJAX Schedule doesn't work properly")}}),$.ajax({url:"load_classes_sma",method:"GET",datatype:"JSON",success:function(e){$(".sma_classes").html(e)},error:function(){alert("AJAX Schedule doesn't work properly")}}),$.ajax({url:"load_classes_smk",method:"GET",datatype:"JSON",success:function(e){$(".smk_classes").html(e)},error:function(){alert("AJAX Schedule doesn't work properly")}})}})}function o(e){$.ajax({url:"load_spec_class_grade",method:"POST",datatye:"JSON",data:{cls:e},success:function(e){$(".std_rep").html(e)},error:function(){alert("Something's Wrong")}})}function i(e){$.ajax({url:"get_grade_weight",method:"POST",dataType:"json",data:{degree:e},success:e=>{e?($('input[data-field="KDWeight"]').val(e.KDWeight),$('input[data-field="KDWeight_SK"]').val(e.KDWeight_SK),$('input[data-field="MidWeight"]').val(e.MidWeight),$('input[data-field="FinalWeight"]').val(e.FinalWeight),$('input[data-field="Absent"]').val(e.Absent)):($(".assg_weight").val(0),$(".test_weight").val(0),$(".mid_weight").val(0),$(".final_weight").val(0))}})}function c(e){$.ajax({url:"get_grade_weight_nat",method:"POST",dataType:"JSON",data:{degree:e},success:function(e){$(".tab-content").find(".weight").each(function(){let t=$(this).attr("data-field");"Absent"==t?($(`.weight[data-desc="${e[0].Type}"][data-field="${t}"]`).val(e[0][t]),$(`.weight[data-desc="${e[1].Type}"][data-field="${t}"]`).val(e[1][t])):"Daily"==t?($(`.weight[data-desc="${e[0].Type}"][data-field="${t}"]`).val(e[0][t]),$(`.weight[data-desc="${e[1].Type}"][data-field="${t}"]`).val(e[1][t])):"Mid"==t?($(`.weight[data-desc="${e[0].Type}"][data-field="${t}"]`).val(e[0][t]),$(`.weight[data-desc="${e[1].Type}"][data-field="${t}"]`).val(e[1][t])):"Final"==t&&($(`.weight[data-desc="${e[0].Type}"][data-field="${t}"]`).val(e[0][t]),$(`.weight[data-desc="${e[1].Type}"][data-field="${t}"]`).val(e[1][t]))})}})}d(),$('input[class=".weight"]').inputmask("99%",{clearMaskOnLostFocus:!1}),$('input[name="display_by"]').change(function(){let e=$(this).val();"cls"==e?($(".std_rep").empty(),d()):"subject"==e&&($(".std_rep").empty(),$(".nav_degrees").empty(),$.ajax({url:"get_table_by_subjects",method:"GET",success:e=>{$(".std_rep").append(e)}}))}),$(".btn_kd").click(function(){e=$(".kd_classes").val(),void 0===t?$("#selected_kd_class").html(`Class: <span style="color: #8E44AD"> ${e} </span>, Subject: <span style="color: red"> ${t} <span>`):$("#selected_kd_class").html(`Class: <span style="color: #8E44AD"> ${e} </span>, Subject: <span style="color: #4B77BE"> ${t} <span>`),$(".material_mapping").modal("show")}),$(".kd_classes").change(function(){e=$(".kd_classes").val(),void 0===t?$("#selected_kd_class").html(`Class: <span style="color: #8E44AD"> ${e} </span>, Subject: <span style="color: red"> ${t} <span>`):$("#selected_kd_class").html(`Class: <span style="color: #8E44AD"> ${e} </span>, Subject: <span style="color: #4B77BE"> ${t} <span>`),l(a,e,t)}),$(".list_subj").click(function(){a="cognitive",e=$(".kd_classes").val(),t=$(this).text(),console.log({type:a,cls:e,subj:t}),void 0===t?$("#selected_kd_class").html(`Class: <span style="color: #8E44AD"> ${e} </span>, Subject: <span style="color: red"> ${t} <span>`):$("#selected_kd_class").html(`Class: <span style="color: #8E44AD"> ${e} </span>, Subject: <span style="color: #4B77BE"> ${t} <span>`),l(a,e,t)}),$('[data-toggle="tab"]').click(function(){l(a=$(this).attr("data-type"),e,t)}),$(".btn_new_kd").click(function(){s=$(this).attr("data-semester");let e=$(this).attr("data-subj");$(".new_kd_title").text(`New KD for ${e} (Semester ${s})`),$(".new_kd").modal("show")}),$(".save_kd").click(function(){let r=$("#material").val(),d=$("#code").val(),o=$("#adjust").val();$(".semester_body").css("display","block"),$.ajax({url:"save_new_kd",method:"POST",data:{type:a,cls:e,subj:t,semester:s,material:r,code:d,adjust:o},success:s=>{"success"==s?(Swal.fire({type:"success",title:"New KD Added"}),$(".new_kd").modal("hide"),$(".semester1, .semester2").empty(),l(a,e,t)):Swal.fire({type:"error",title:"Cannot Proceed",text:"make sure to enter the necessary form"})},error:e=>{alert(e.responseText)}})}),$(".semester1, .semester2").on("keypress",'td[contenteditable="true"]',function(e){let t=$(this).attr("data-field"),s=$(this).text(),l=$(this).parents("tr").attr("data-code"),d=$(this).parents("tr").attr("data-semester"),o=$(this).parents("tr").attr("data-subj");"Code"==t&&(s=s.replace(/\s+/g,""));let i={type:a,field:t,newval:s,code:l,semester:d,subj:o};13==e.keyCode&&(e.preventDefault(),r(i))}),$(".table").on("click",".delete_kd",function(){let t=$(this).parents("tr").attr("data-code"),s=$(this).parents("tr").attr("data-semester"),r=$(this).parents("tr").attr("data-subj");$.ajax({url:"delete_kd",method:"POST",data:{type:a,code:t,semester:s,subj:r},success:()=>{$(".semester1, .semester2").empty(),l(a,e,r)}})}),$(".grade_opt").click(function(){$(".opt_modal").modal("show");let e=$(".glevel").val();var t;u(e),i(e),c(e),function(e){$.ajax({url:"get_kkm",method:"POST",data:{degree:e},success:e=>{$(".kkm_minimum").val(e)},error:e=>{console.log(e)}})}(e),t=$(".edit_predicate"),$.ajax({url:"load_predicate",method:"POST",success:function(e){t.empty(),$(t).append(e)}})});var n,_,p="";function u(e){$.ajax({url:"get_active_days",method:"POST",data:{degree:e},success:e=>{$(".active_days").val(e)}})}function m(e,t,a){$.ajax({url:"post_predicate",method:"POST",data:{predicate:e,max:t,min:a},success:function(){Swal.fire({type:"success",title:"Success",text:"Predicate has been updated",showConfirmButton:!1})},error:function(){Swal.fire({type:"error",title:"Oops...",text:"Something went wrong!",showConfirmButton:!1})}})}$(".glevel").change(function(){i(p=$(this).val()),c(p)}),$(".active_days").keypress(function(e){if(13==e.which){let e=$(".glevel").val(),t=$(this).val();console.table({degree:e,value:t}),$.ajax({url:"sv_active_days",method:"POST",data:{degree:e,value:t},success:t=>{"success"==t?(Swal.fire({type:"success",title:"Saved",text:"School Active Days has been updated"}),u(e)):Swal.fire({type:"error",title:"Save Failed",text:"Failed to update new School Active Days"})}})}}),$(".weight").on("keypress",function(e){var t=$(this).parent("div");let a=$(".glevel").val(),s=$(this).attr("data-desc"),l=$(this).attr("data-field"),r=$(this).val();13==e.keyCode&&(e.preventDefault(),$.ajax({url:"save_nat_weight",method:"POST",data:{degree:a,type:s,field:l,val:r},success:function(){t.addClass("has-success"),setTimeout(function(){t.removeClass("has-success")},2e3)}}))}),$(".edit_predicate").on("keypress",'td[contenteditable="true"]',function(e){if(13==e.keyCode){e.preventDefault();let t=$(this).parent("tr").attr("data-prd"),a=$(`tr[data-prd="${t}"]`).children('td[data-prd="max"]').html(),s=$(`tr[data-prd="${t}"]`).children('td[data-prd="min"]').html(),l=t.charCodeAt(0),r=l-1,d=l+1;predicatetopmin=String.fromCharCode(r),predicatebottommax=String.fromCharCode(d);let o=$(`tr[data-prd="${predicatetopmin}"]`).children('td[data-prd="min"]').html(),i=$(`tr[data-prd="${predicatebottommax}"]`).children('td[data-prd="max"]').html();"A"!=t&&"D"!=t?a<o&&s>i?m(t,a,s):Swal.fire({type:"warning",title:"Alter Predicate Failed",text:"Make sure Maximum value is below Upper Predicate and Minimum value is higher than Below Predicate"}):"A"==t?a<=100&&s>i?m(t,a,s):Swal.fire({type:"warning",title:"Alter Predicate Failed",text:"Make sure Maximum value is below Upper Predicate and Minimum value is higher than Below Predicate"}):"D"==t&&(a<o&&s<=0?m(t,a,s):Swal.fire({type:"warning",title:"Alter Predicate Failed",text:"Make sure Maximum value is below Upper Predicate and Minimum value is higher than Below Predicate"}))}}),$(".subject_weight").keypress(function(e){if(13==e.which){e.preventDefault();let t=$(".glevel option:selected").val(),a=$(this).attr("data-field"),s=$(this).val();console.table({grade_level:t,field:a,value:s}),$.ajax({url:"save_grade_weight",method:"POST",data:{lvl:t,field:a,value:s},success:e=>{"success"==e?Swal.fire({type:"success",title:"Saved",text:"Grade's Weight has been updated"}):Swal.fire({type:"error",title:"Save Failed",text:"Grade's Weight failed to save into database"})}})}}),$(".kkm_minimum").keypress(function(e){if(13==e.keyCode){e.preventDefault();let t=$(".glevel option:selected").val(),a=$(this).val();console.table({grade_level:t,kkm:a}),$.ajax({url:"save_new_kkm",method:"POST",data:{lvl:t,kkm:a},success:e=>{"success"==e?Swal.fire({type:"success",title:"Saved",text:"Grade's Weight has been updated"}):Swal.fire({type:"error",title:"Save Failed",text:"Grade's Weight failed to save into database"})},error:e=>{console.log(e)}})}}),$(".nav_degrees").on("click",".cls_grade",function(){const e=$(this).attr("data-room");console.log(`DATA TO POST: ${e}`),o(e)}),$(".std_rep").on("click",".sub_class",function(){const e=$(this).attr("data-room");console.log(`ROOM: ${e}`),$.ajax({url:"load_sub_class_grade",method:"POST",datatype:"JSON",data:{room:e},success:function(e){$(".portlet_subcls").html(e)},error:function(e){console.log(`ERROR: ${e}`)}})}),$(".std_rep").on("click",".btn_grade",function(){n=$(this).attr("data-subject"),_=$(this).attr("data-type"),function(){"skills"==_?$(".full_details_skills").modal("show"):"cognitive"==_?$(".full_details_cognitive").modal("show"):"character"==_?$(".full_details_character").modal("show"):"voc"==_&&$(".full_details_voc").modal("show");S(b,v,k,n,_)}()});var h,y,f,g,b=$(".by_cls").val(),v=$(".by_year option:selected").val(),k=$(".by_year option:selected").attr("data-semester");function S(e,t,a,s,l){let r;"cognitive"==l?r="get_full_table_details_cognitive":"skills"==l?r="get_full_table_details_skills":"character"==l?r="get_full_table_details_character":"voc"==l&&(r="get_full_table_details_voc"),$.ajax({url:r,method:"POST",dataType:"JSON",data:{cls:e,year:t,semester:a,subj:s,type:l},success:e=>{console.log(l),"cognitive"==l?($(".tbl_detailed_cognitive").html(e.full),$(".tbl_recap_cognitive").html(e.recap),$(".tbl_summary_cognitive").html(e.summary)):"skills"==l?($(".tbl_detailed_skills").html(e.recap),$(".tbl_summary_skills").html(e.summary)):"character"==l?($(".tbody_soc").html(e.SOC),$(".tbody_spr").html(e.SPR)):"voc"==l&&$(".tbody_voc").html(e.voc)},error:e=>{console.log(e.responseText)}})}function j(e,t,a,s){$("#rep_full_title").text(`REPORT ${e} - ${t}`);let l=`nis=${e}&cls=${t}&subj=${a}&semester=${s}`;$(".print_grade_report").attr("href",`${base_url}Admin/display_report_print?${l}`),$("body .print_grade_mid_report").attr("href",`${base_url}Admin/display_report_mid_print?${l}`),$.ajax({url:"get_grade_report",method:"POST",dataType:"JSON",data:{nis:e,cls:t,subj:a,semester:s},success:e=>{$(".kd_cog").html(e.KDCog),$(".kd_sk").html(e.KDSK),$(".exam_cog").html(e.EXM),$(".exam_sk").html(e.EXM),$(".report_voc").html(e.VOC),$(".report_cog").html(e.REPCog),$(".report_sk").html(e.REPSK),$(".desc_cog").html(e.DESCCog),$(".desc_sk").html(e.DESCSK),$(".report_soc").html(e.SOC),$(".report_spr").html(e.SPR)},error:e=>{console.log(e)}})}function O(e,t,a){var s=$(".grade_report_tbody"),l=$(".skills_report_tbody"),r=$(".grade_report_spectrum"),d=$(".absent_report_tbody");$("#compact_title").text(`REPORT ${e} - ${t}`),$.ajax({url:"get_grade_report_compact",method:"POST",dataType:"JSON",data:{nis:e,cls:t,semester:a},success:e=>{s.html(e.COG),l.html(e.SK),r.html(e.Spectrum),$(".soc_report_tbody").html(e.SOC),$(".spr_report_tbody").html(e.SPR),$(".voc_report_tbody").html(e.VOC),""!=e.Absent?d.html(e.Absent):d.html('<tr>\n                                <td colspan="2" width="2%"> This student has no absent for this semester </td> \n                            </tr>')},error:e=>{alert(e)}})}$(".by_cls").on("change",function(){b=$(this).val(),v=$(this).parents(".modal-body").find(".by_year").val(),k=$(this).parents(".modal-body").find(".by_year option:selected").attr("data-semester"),S(b,v,k,n,_)}),$(".by_year").on("change",function(){b=$(this).parents(".modal-body").find(".by_cls").val(),v=$(this).val(),k=$(this).find("option:selected").attr("data-semester"),S(b,v,k,n,_)}),$(".radio_semester").click(function(){b=$(this).parents(".modal-body").find(".by_cls").val(),v=$(this).parents(".modal-body").find(".by_year").val(),k=$(this).parents(".modal-body").find(".by_year option:selected").attr("data-semester"),"compact_select_semester"!==$(this).attr("name")&&S(b,v,k,n,_)}),$(".std_rep").on("click",".btn_detail, .btn_detail_compact",function(){var e;$(this).hasClass("btn_detail")?($(".details_grade").modal("show"),g=$('[name="full_select_semester"]:checked').attr("data-semester"),e="full"):($(".details_grade_compact").modal("show"),g=$('[name="compact_select_semester"]:checked').attr("data-semester"),e="compact"),h=$(this).attr("data-nis"),y=$(this).attr("data-class");let t=$(".list_subj_std");console.table({full_rep_nis:h,full_rep_cls:y,rep_semester:g}),$.ajax({url:"get_std_subject_list",method:"POST",data:{nis:h,cls:y,rep_semester:g},success:a=>{t.empty(),t.append(a),f=$(".list_subj_std select").val(),"full"==e?j(h,y,f,g):"compact"==e&&O(h,y,g)}})}),$(".list_subj_std").on("change",".avail_subj",function(){f=$(this).val(),j(h,y,f,g)}),$(".details_grade, .details_grade_compact").on("click",'input[type="radio"]',function(){let e=$(".list_subj_std");"compact_select_semester"!==$(this).attr("name")?(g=$('[name="full_select_semester"]:checked').attr("data-semester"),$.ajax({url:"get_std_subject_list",method:"POST",data:{subj:f,nis:h,cls:y,rep_semester:g},success:t=>{e.empty(),e.append(t)}}).then(()=>{f=$(".avail_subj").val(),console.table({selected_subj:f,full_rep_nis:h,full_rep_cls:y,rep_semester:g})}).then(()=>j(h,y,f,g))):"compact_select_semester"===$(this).attr("name")&&(g=$('[name="compact_select_semester"]:checked').attr("data-semester"),console.table({full_rep_nis:h,full_rep_cls:y,rep_semester:g}),O(h,y,g))}),$(".tbl_detailed_cognitive").on("keypress",'thead td[contenteditable="true"]',function(e){if(13==e.keyCode){e.preventDefault();let t=$(this).parents(".modal-body").find(".by_year").val(),a=$(this).parents(".modal-body").find(".by_year option:selected").attr("data-semester"),s=$(this).attr("data-type"),l=$(this).attr("data-subj"),r=$(this).attr("data-code"),d=$(this).attr("data-field"),o=$(this).text();o=o.replace(/\s+/g,""),$.ajax({url:"update_kd_weight",method:"POST",data:{room:b,year:t,semester:a,type:s,subj:l,code:r,field:d,value:o},success:e=>{"success"==e?S(b,t,a,n,_):"INVALID_PERIOD"==e?alert("CANNOT UPDATE OLD PERIOD!"):console.log(e)},error:e=>{console.log(e)}})}}),$(".tbl_detailed_skills").on("keypress",'thead td[contenteditable="true"]',function(e){if(13==e.keyCode&&!$(this).is(".kd_desc_sk")){e.preventDefault(),alert("TEST");let t=$(this).parents(".modal-body").find(".by_year").val(),a=$(this).parents(".modal-body").find(".by_year option:selected").attr("data-semester"),s=b,l=$(this).attr("data-subj"),r=$(this).attr("data-field"),d=$(this).text();d=d.replace(/\s+/g,""),$.ajax({url:"update_recap_weight",method:"POST",data:{room:s,year:t,semester:a,subj:l,field:r,value:d},success:e=>{"success"==e?S(b,t,a,n,_):"INVALID_PERIOD"==e?alert("CANNOT UPDATE OLD PERIOD!"):console.log(e)},error:e=>{console.log(e.responseText)}})}}),$(".tbl_detailed_skills").on("keypress",".kd_desc_sk",function(e){if(13==e.keyCode){e.preventDefault();let t=$(this).parents(".modal-body").find(".by_year").val(),a=$(this).parents(".modal-body").find(".by_year option:selected").attr("data-semester"),s=$(this).attr("data-type"),l=$(this).attr("data-subj"),r=$(this).attr("data-code"),d=$(this).attr("data-field"),o=$(this).text();console.table({type:s,subj:l,code:r,field:d,value:o}),console.table({grade_cls:b,semester:a,grade_subj:n,grade_type:_}),$.ajax({url:"update_kd_weight",method:"POST",data:{room:b,year:t,semester:a,type:s,subj:l,code:r,field:d,value:o},success:e=>{"success"==e?S(b,t,a,n,_):"INVALID_PERIOD"==e?alert("CANNOT UPDATE OLD PERIOD!"):console.log(e)}})}}),$("#detailed_cognitive, #detailed_skills").on("keypress",".table_body",function(e){if(13==e.keyCode){e.preventDefault();let s=$(this).attr("data-row"),l=$(this).siblings().eq(1).text();l=l.replace(/\s+/g,"");let r=$(this).parents(".modal-body").find(".by_year").val(),d=$(this).parents(".modal-body").find(".by_year option:selected").attr("data-semester"),o=$(this).parent("tr").attr("data-class"),i=$(this).parent("tr").attr("data-room");t=n,a=_;let c=$(this).attr("data-field"),p=$(this).text();if(p=p.replace(/\s+/g,""),"kd"==s){let e=$(this).siblings().eq(2).text(),u=$(this).attr("data-code");u=u.replace(/\s+/g,""),$.ajax({url:"sv_std_kd_grades",method:"POST",data:{row:s,nis:l,year:r,semester:d,fullname:e,cls:o,room:i,subj:t,type:a,code:u,field:c,val:p},success:e=>{"success"==e?S(b,r,d,n,_):"INVALID_PERIOD"==e?alert("CANNOT UPDATE OLD PERIOD!"):console.log(e)},error:e=>{console.log(e)}})}else $.ajax({url:"sv_std_exam_grades",method:"POST",data:{row:s,cls:o,nis:l,year:r,semester:d,room:i,subj:t,type:a,field:c,val:p},success:e=>{"success"==e?S(b,r,d,n,_):"INVALID_PERIOD"==e?alert("CANNOT UPDATE OLD PERIOD!"):console.log(e)},error:e=>{console.log(e)}})}}),$(".tbody_soc, .tbody_spr").on("keypress",".data_soc_char, .data_spr_char",function(e){if(13==e.keyCode){e.preventDefault();let t=$(this).parents(".modal-body").find(".by_year").val(),a=$(this).parents(".modal-body").find(".by_year option:selected").attr("data-semester"),s=$(this).siblings().eq(1).text();s=s.replace(/\s+/g,"");let l=$(this).siblings().eq(2).text(),r=n,d=$(this).parent("tr").attr("data-room"),o=$(this).attr("data-type"),i=$(this).attr("data-desc"),c=$(this).text();c=c.replace(/\s+/g,""),isNaN(c)||c<1||c>4?alert("only number 1 - 4 is allowed"):$.ajax({url:"sv_std_char_grades",method:"POST",data:{nis:s,name:l,year:t,semester:a,subj:r,room:d,type:o,desc:i,value:c}}).then(e=>{"success"==e?S(b,t,a,n,_):"INVALID_PERIOD"==e?alert("CANNOT UPDATE OLD PERIOD!"):console.log(e)})}}),$(".tbody_voc").on("keypress",".voc_grade",function(e){if(13==e.keyCode){e.preventDefault();let t=$(this).attr("data-nis"),a=$(this).attr("data-semester"),s=$(this).attr("data-period"),l=$(this).attr("data-room"),r=$(this).attr("data-subjname"),d=$(this).text();d=d.replace(/\s+/g,""),$.ajax({url:"sv_std_voc_grades",method:"POST",data:{nis:t,semester:a,period:s,room:l,subj:r,value:d},error:e=>console.log(e.responseText)}).then(e=>{"success"==e?S(l,s,a,r,"voc"):"INVALID_PERIOD"==e?alert("CANNOT UPDATE OLD PERIOD!"):console.log(e)})}})}});