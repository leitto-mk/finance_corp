$(document).ready(function(){if($("div").is(".absent")){$('select[name="search"]').change(function(){"Class"==$(this).val()?($(".search-sel").empty(),$.ajax({url:"get_classes",method:"GET",success:function(t){$(".search-sel").append(t)}})):"Personal"==$(this).val()?($(".search-sel").empty(),$(".search-sel").append('<input type="text" class="form-control search_person" data-status="student" placeholder="Enter NIS/Name">')):"Teacher"==$(this).val()&&($(".search-sel").empty(),$(".search-sel").append('<input type="text" class="form-control search_person" data-status="teacher" placeholder="Enter ID/Name">'))});var t="";$(".search-sel").on("change","#class_dd",function(){t=$(this).val();$.ajax({url:"get_tbl_byclass",method:"POST",data:{room:t},success:function(t){$(".btn-absn").empty(),$(".search-result").empty(),$('<div class="btn-absn" style="margin-top: 20px;"><a href="javascript:;" class="btn btn-circle btn-md red btn_add_absn" data-status="student"><i class="fa fa-plus"></i> Absent </a></div>').insertAfter(".tbl_list"),$(".search-result").append(t)}})}),$(".search-sel").on("keyup",".search_person",function(){let t="";"student"===$(this).attr("data-status")?t="student":"teacher"===$(this).attr("data-status")&&(t="teacher");let e=$(this).val();if(console.log(`SEARCH FOR: ${e} WITH STATUS AS: ${t}`),""==e)$(".search-result").children().remove(),$(".btn-absn").remove(),$(".search-result").append('<tr class="gradeX odd" role="row"><td colspan = "2"> USE THE DROPDOWN / SEARCH BUTTON </td ></tr >');else{let a='<div class="btn-absn" style="margin-top: 20px;"><a href="javascript:;" class="btn btn-circle btn-md red btn_add_absn" data-status="'+t+'"><i class="fa fa-plus"></i> Absent </a></div>';$.ajax({url:"get_tbl_personal",method:"POST",data:{search:e,status:t},success:function(t){$(".btn-absn").empty(),$(".search-result").empty(),$(a).insertAfter(".tbl_list"),$(".search-result").append(t)}})}});var e,a=[];function s(t,e){$.ajax({url:"get_absn_det",method:"POST",data:{id:t,status:e},success:function(t){$(".tbl_portlet_cls").empty(),$(".tbl_portlet_cls").append(t).fadeIn(500)}})}$("#search-absn").on("click",".btn_add_absn",function(){a=[],$(".absn_list_for_submit").empty(),"student"===$(this).attr("data-status")?e="student":"teacher"===$(this).attr("data-status")&&(e="teacher"),$(".form-check-input").each(function(){if($(this).is(":checked")){a.push($(this).val());let t=$(this).val(),e=$(this).attr("data-name");$(".absn_list_for_submit").append(`<tr data-id="${t}"> \n                            <td width="1%" class="sbold"> ${t} </td>\n                            <td> ${e} \n                                <a href="javascript:;" class="btn btn-icon-only cancel_list" style="color: #e7505a">\n                                    <i class="fa fa-times"></i>\n                                </a>\n                            <td>\n                        </tr>`)}}),$.ajax({url:"get_ids_cur_subject",method:"POST",dataType:"JSON",data:{room:t},success:t=>{let e="";t.forEach(t=>{e+=`<option value="${t.SubjName}">${t.SubjName}</option>`}),$("#abs_subj").html(e)},error:t=>{console.log(t.responseText)}}),$(".sv_absent_modal").modal("show")}),$("#pick_absent_date").daterangepicker({singleDatePicker:!0,showDropdowns:!0,minYear:2e3,maxYear:parseInt(moment().format("YYYY"),10)}),$(".sv_absent_modal").on("click",'input[type="radio"]',function(){"student"!=e||"Truant"!=$(this).val()&&"Late"!=$(this).val()?$("#absent_misc").hide():$("#absent_misc").show()}),$(".absn_list_for_submit").on("click",".cancel_list",function(){let t=$(this).parents("tr").attr("data-id");$(`tr[data-id="${t}"]`).remove(),a=_.without(a,t)}),$(".submit_absent").click(function(){let t=$('input[name="radio2"]:checked').val(),n=$("#pick_absent_date").val(),l="",c="";"Truant"!=t&&"Late"!=t||(l=$("#abs_subj").val(),c=$("#abs_time").val()),a.length>0&&""!=t?$.ajax({url:"add_absent_std",method:"POST",data:{selected:a,type:t,new_date:n,subj:l,time:c,status:e},success:t=>{console.log(`${t}`),Swal.fire({type:"success",title:"SUCCESS",text:"ABSENT HAS BEEN ADDED"}),$(".sv_absent_modal").modal("hide"),1==a.length&&s(a[0],e)},error:t=>{console.log(t.responseText),console.log(`FAILED TO ADD ABSENT: ${t}`),Swal.fire({type:"error",title:"ERROR",text:"ABSENT SUBMITION FAILED DUE TO FALSE INPUT"})}}):""==t?alert("Please check the Absent type"):alert("No people listed")}),$(".search-result").on("click",".nis",function(t){t.preventDefault();let e=$(this).attr("data-id"),a="";a="student"==$(this).attr("data-status")?"student":"teacher",console.log(`clicked on ${e}, status: ${a}`),s(e,a)})}});